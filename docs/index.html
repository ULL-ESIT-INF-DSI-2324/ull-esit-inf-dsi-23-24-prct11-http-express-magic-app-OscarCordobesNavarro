<!DOCTYPE html><html class="default" lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>游눹 Pr치ctica 10 - Aplicaci칩n cliente-servidor para coleccionistas de cartas Magic 游눹</title><meta name="description" content="Documentation for 游눹 Pr치ctica 10 - Aplicaci칩n cliente-servidor para coleccionistas de cartas Magic 游눹"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script defer src="assets/main.js"></script><script async src="assets/icons.js" id="tsd-icons-script"></script><script async src="assets/search.js" id="tsd-search-script"></script><script async src="assets/navigation.js" id="tsd-nav-script"></script><style>
@media (prefers-color-scheme: dark) {
  :root {
    --md-sys-color-primary: #00e466;
    --md-sys-color-on-primary: #003914;
    --md-sys-color-primary-container: #005320;
    --md-sys-color-on-primary-container: #67ff8b;
    --md-sys-color-secondary: #b8ccb6;
    --md-sys-color-on-secondary: #243425;
    --md-sys-color-secondary-container: #3a4b3a;
    --md-sys-color-on-secondary-container: #d4e8d1;
    --md-sys-color-tertiary: #a1ced7;
    --md-sys-color-on-tertiary: #00363d;
    --md-sys-color-tertiary-container: #1f4d54;
    --md-sys-color-on-tertiary-container: #bdeaf3;
    --md-sys-color-error: #ffb4ab;
    --md-sys-color-on-error: #690005;
    --md-sys-color-error-container: #93000a;
    --md-sys-color-on-error-container: #ffb4ab;
    --md-sys-color-background: #1a1c19;
    --md-sys-color-on-background: #e2e3dd;
    --md-sys-color-surface: #1a1c19;
    --md-sys-color-on-surface: #e2e3dd;
    --md-sys-color-surface-variant: #424941;
    --md-sys-color-on-surface-variant: #c1c9be;
    --md-sys-color-outline: #8b9389;
    --md-sys-color-outline-variant: #424941;
    --md-sys-color-shadow: #000000;
    --md-sys-color-scrim: #000000;
    --md-sys-color-inverse-surface: #e2e3dd;
    --md-sys-color-inverse-on-surface: #2e312d;
    --md-sys-color-inverse-primary: #006e2d;
    --md-sys-color-surface-dim: #111411;
    --md-sys-color-surface-bright: #373a36;
    --md-sys-color-surface-container-lowest: #0c0f0c;
    --md-sys-color-surface-container-low: #1a1c19;
    --md-sys-color-surface-container: #1e201d;
    --md-sys-color-surface-container-high: #282b27;
    --md-sys-color-surface-container-highest: #333532
  }
}
:root[data-theme="dark"] {
  --md-sys-color-primary: #00e466;
  --md-sys-color-on-primary: #003914;
  --md-sys-color-primary-container: #005320;
  --md-sys-color-on-primary-container: #67ff8b;
  --md-sys-color-secondary: #b8ccb6;
  --md-sys-color-on-secondary: #243425;
  --md-sys-color-secondary-container: #3a4b3a;
  --md-sys-color-on-secondary-container: #d4e8d1;
  --md-sys-color-tertiary: #a1ced7;
  --md-sys-color-on-tertiary: #00363d;
  --md-sys-color-tertiary-container: #1f4d54;
  --md-sys-color-on-tertiary-container: #bdeaf3;
  --md-sys-color-error: #ffb4ab;
  --md-sys-color-on-error: #690005;
  --md-sys-color-error-container: #93000a;
  --md-sys-color-on-error-container: #ffb4ab;
  --md-sys-color-background: #1a1c19;
  --md-sys-color-on-background: #e2e3dd;
  --md-sys-color-surface: #1a1c19;
  --md-sys-color-on-surface: #e2e3dd;
  --md-sys-color-surface-variant: #424941;
  --md-sys-color-on-surface-variant: #c1c9be;
  --md-sys-color-outline: #8b9389;
  --md-sys-color-outline-variant: #424941;
  --md-sys-color-shadow: #000000;
  --md-sys-color-scrim: #000000;
  --md-sys-color-inverse-surface: #e2e3dd;
  --md-sys-color-inverse-on-surface: #2e312d;
  --md-sys-color-inverse-primary: #006e2d;
  --md-sys-color-surface-dim: #111411;
  --md-sys-color-surface-bright: #373a36;
  --md-sys-color-surface-container-lowest: #0c0f0c;
  --md-sys-color-surface-container-low: #1a1c19;
  --md-sys-color-surface-container: #1e201d;
  --md-sys-color-surface-container-high: #282b27;
  --md-sys-color-surface-container-highest: #333532
}

@media (prefers-color-scheme: light) {
  :root {
    --md-sys-color-primary: #006e2d;
    --md-sys-color-on-primary: #ffffff;
    --md-sys-color-primary-container: #67ff8b;
    --md-sys-color-on-primary-container: #002109;
    --md-sys-color-secondary: #516351;
    --md-sys-color-on-secondary: #ffffff;
    --md-sys-color-secondary-container: #d4e8d1;
    --md-sys-color-on-secondary-container: #0f1f11;
    --md-sys-color-tertiary: #39656c;
    --md-sys-color-on-tertiary: #ffffff;
    --md-sys-color-tertiary-container: #bdeaf3;
    --md-sys-color-on-tertiary-container: #001f24;
    --md-sys-color-error: #ba1a1a;
    --md-sys-color-on-error: #ffffff;
    --md-sys-color-error-container: #ffdad6;
    --md-sys-color-on-error-container: #410002;
    --md-sys-color-background: #fcfdf7;
    --md-sys-color-on-background: #1a1c19;
    --md-sys-color-surface: #fcfdf7;
    --md-sys-color-on-surface: #1a1c19;
    --md-sys-color-surface-variant: #dde5d9;
    --md-sys-color-on-surface-variant: #424941;
    --md-sys-color-outline: #727970;
    --md-sys-color-outline-variant: #c1c9be;
    --md-sys-color-shadow: #000000;
    --md-sys-color-scrim: #000000;
    --md-sys-color-inverse-surface: #2e312d;
    --md-sys-color-inverse-on-surface: #f0f1eb;
    --md-sys-color-inverse-primary: #00e466;
    --md-sys-color-surface-dim: #d9dbd5;
    --md-sys-color-surface-bright: #f9faf4;
    --md-sys-color-surface-container-lowest: #ffffff;
    --md-sys-color-surface-container-low: #f3f4ee;
    --md-sys-color-surface-container: #edeee9;
    --md-sys-color-surface-container-high: #e7e9e3;
    --md-sys-color-surface-container-highest: #e2e3dd
  }
}
:root[data-theme="light"] {
  --md-sys-color-primary: #006e2d;
  --md-sys-color-on-primary: #ffffff;
  --md-sys-color-primary-container: #67ff8b;
  --md-sys-color-on-primary-container: #002109;
  --md-sys-color-secondary: #516351;
  --md-sys-color-on-secondary: #ffffff;
  --md-sys-color-secondary-container: #d4e8d1;
  --md-sys-color-on-secondary-container: #0f1f11;
  --md-sys-color-tertiary: #39656c;
  --md-sys-color-on-tertiary: #ffffff;
  --md-sys-color-tertiary-container: #bdeaf3;
  --md-sys-color-on-tertiary-container: #001f24;
  --md-sys-color-error: #ba1a1a;
  --md-sys-color-on-error: #ffffff;
  --md-sys-color-error-container: #ffdad6;
  --md-sys-color-on-error-container: #410002;
  --md-sys-color-background: #fcfdf7;
  --md-sys-color-on-background: #1a1c19;
  --md-sys-color-surface: #fcfdf7;
  --md-sys-color-on-surface: #1a1c19;
  --md-sys-color-surface-variant: #dde5d9;
  --md-sys-color-on-surface-variant: #424941;
  --md-sys-color-outline: #727970;
  --md-sys-color-outline-variant: #c1c9be;
  --md-sys-color-shadow: #000000;
  --md-sys-color-scrim: #000000;
  --md-sys-color-inverse-surface: #2e312d;
  --md-sys-color-inverse-on-surface: #f0f1eb;
  --md-sys-color-inverse-primary: #00e466;
  --md-sys-color-surface-dim: #d9dbd5;
  --md-sys-color-surface-bright: #f9faf4;
  --md-sys-color-surface-container-lowest: #ffffff;
  --md-sys-color-surface-container-low: #f3f4ee;
  --md-sys-color-surface-container: #edeee9;
  --md-sys-color-surface-container-high: #e7e9e3;
  --md-sys-color-surface-container-highest: #e2e3dd
}
</style><link rel="stylesheet" href="assets/material-style.css"/></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search" data-base="."><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">游눹 Pr치ctica 10 - Aplicaci칩n cliente-servidor para coleccionistas de cartas Magic 游눹</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><h2>游눹 Pr치ctica 10 - Aplicaci칩n cliente-servidor para coleccionistas de cartas Magic 游눹</h2></div><div class="tsd-panel tsd-typography"><p align="center">
  <a href="https://github.com/ULL-ESIT-INF-DSI-2324/ull-esit-inf-dsi-23-24-prct10-fs-proc-sockets-magic-app-OscarCordobesNavarro/actions/workflows/node.js.yml">
    <img src="https://github.com/ULL-ESIT-INF-DSI-2324/ull-esit-inf-dsi-23-24-prct10-fs-proc-sockets-magic-app-OscarCordobesNavarro/actions/workflows/node.js.yml/badge.svg" alt="Tests">
  </a>
  <a href="https://github.com/ULL-ESIT-INF-DSI-2324/ull-esit-inf-dsi-23-24-prct10-fs-proc-sockets-magic-app-OscarCordobesNavarro/actions/workflows/coveralls.yml">
    <img src="https://github.com/ULL-ESIT-INF-DSI-2324/ull-esit-inf-dsi-23-24-prct10-fs-proc-sockets-magic-app-OscarCordobesNavarro/actions/workflows/coveralls.yml/badge.svg" alt="Coverage Status">
  </a>
  <a href="https://github.com/ULL-ESIT-INF-DSI-2324/ull-esit-inf-dsi-23-24-prct10-fs-proc-sockets-magic-app-OscarCordobesNavarro/actions/workflows/sonarcloud.yml">
    <img src="https://github.com/ULL-ESIT-INF-DSI-2324/ull-esit-inf-dsi-23-24-prct10-fs-proc-sockets-magic-app-OscarCordobesNavarro/actions/workflows/sonarcloud.yml/badge.svg" alt="Quality Gate Status">
  </a>
</p>

<a id="md:introducci칩n" class="tsd-anchor"></a><h1><a href="#md:introducci칩n">Introducci칩n</a></h1><p>En esta practica vamos a adentrarnos en el uso del paquete net de Node.JS que nos permite crear sockets para poder intercomunicar procesos. Vamos a utilizarlo para actualizar nuestro proyecto de la practica anterior. Vamos a generar un sistema servidor-cliente donde los clientes sean los que soliciten al servidor la informaci칩n que requieran, el usuario seguir치 utilizando el programa como antes, pero esta vez no ser치 su maquina quien realize las operaciones.</p>
<a id="md:aplicaci칩n-para-coleccionistas-de-cartas-magic-cliente-servidor" class="tsd-anchor"></a><h1><a href="#md:aplicaci칩n-para-coleccionistas-de-cartas-magic-cliente-servidor">Aplicaci칩n para coleccionistas de cartas Magic cliente-servidor</a></h1><p>Antes de nada, debemos echarle un ojo a lo que teniamos anteriormente, que en mi caso he decicido adaptar el c칩digo que ya ten칤a, tanto las interfaces y los enumerados siguen siendo las mismas.</p>
<p>El cambio principal que se ha realizado respecto al c칩digo que ten칤amos en la anterior practica es que he migrado las operaciones sincronas a operaciones asincronas utilizando la API basada en callbacks de Node.JS. Por lo que la implementaci칩n de la clase <code>CardCollectionHandler</code> ha cambiado por completo manteniendo la estructura y pasando a tener el nombre de <code>CardCollecetionHandlerAsync</code>. Adem치s he tenido que a침adir algunos m칠todos adicionales para obtener las cadenas, se tratan de <code>getStringCollection</code> y <code>getStringCard</code> y algunos m칠todos privados de ayuda para encapsular mejor.</p>
<p>Un ejemplo del cambio ser칤a:</p>
<pre><code class="language-typescript"><span class="hl-0">  </span><span class="hl-1">private</span><span class="hl-0"> </span><span class="hl-2">checkCardFileAndWrite</span><span class="hl-0">(</span><br/><span class="hl-0">    </span><span class="hl-1">card</span><span class="hl-0">: </span><span class="hl-1">ICard</span><span class="hl-0">,</span><br/><span class="hl-0">    </span><span class="hl-1">callback</span><span class="hl-0">: (</span><span class="hl-1">error</span><span class="hl-0">: </span><span class="hl-3">Error</span><span class="hl-0"> | </span><span class="hl-3">null</span><span class="hl-0">) </span><span class="hl-4">=&gt;</span><span class="hl-0"> </span><span class="hl-4">void</span><span class="hl-0">,</span><br/><span class="hl-0">  ): </span><span class="hl-4">void</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">filePath</span><span class="hl-0"> = </span><span class="hl-4">this</span><span class="hl-0">.</span><span class="hl-2">getCardFilePath</span><span class="hl-0">(</span><span class="hl-1">card</span><span class="hl-0">.</span><span class="hl-1">id</span><span class="hl-0">);</span><br/><span class="hl-0">    </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">data</span><span class="hl-0"> = </span><span class="hl-5">JSON</span><span class="hl-0">.</span><span class="hl-2">stringify</span><span class="hl-0">(</span><span class="hl-1">card</span><span class="hl-0">, </span><span class="hl-4">undefined</span><span class="hl-0">, </span><span class="hl-6">2</span><span class="hl-0">);</span><br/><span class="hl-0">    </span><span class="hl-4">this</span><span class="hl-0">.</span><span class="hl-2">checkCardFile</span><span class="hl-0">(</span><span class="hl-1">card</span><span class="hl-0">.</span><span class="hl-1">id</span><span class="hl-0">, (</span><span class="hl-1">err</span><span class="hl-0">) </span><span class="hl-4">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">      </span><span class="hl-7">if</span><span class="hl-0"> (</span><span class="hl-1">err</span><span class="hl-0">) {</span><br/><span class="hl-0">        </span><span class="hl-7">return</span><span class="hl-0"> </span><span class="hl-2">callback</span><span class="hl-0">(</span><span class="hl-1">err</span><span class="hl-0">);</span><br/><span class="hl-0">      } </span><span class="hl-7">else</span><span class="hl-0"> {</span><br/><span class="hl-0">        </span><span class="hl-1">fs</span><span class="hl-0">.</span><span class="hl-2">writeFile</span><span class="hl-0">(</span><span class="hl-1">filePath</span><span class="hl-0">, </span><span class="hl-1">data</span><span class="hl-0">, (</span><span class="hl-1">err</span><span class="hl-0">) </span><span class="hl-4">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">          </span><span class="hl-7">if</span><span class="hl-0"> (</span><span class="hl-1">err</span><span class="hl-0">) {</span><br/><span class="hl-0">            </span><span class="hl-7">return</span><span class="hl-0"> </span><span class="hl-2">callback</span><span class="hl-0">(</span><span class="hl-1">err</span><span class="hl-0">);</span><br/><span class="hl-0">          }</span><br/><span class="hl-0">          </span><span class="hl-2">callback</span><span class="hl-0">(</span><span class="hl-4">null</span><span class="hl-0">);</span><br/><span class="hl-0">        });</span><br/><span class="hl-0">      }</span><br/><span class="hl-0">    });</span><br/><span class="hl-0">  }</span>
</code><button>Copy</button></pre>
<p>Por si alguna duda recomiendo revisar la carpeta <code>Previo</code> para ver las operaciones fundamentales en la que se basa el servidor.</p>
<p>Ahora procedemos a la implementaci칩n del cliente. En mi caso, he creado la clase <code>MagicClient</code> para facilitar y simplificar la conexi칩n al servidor. Esta clase se conecta al servidor tan pronto como se instancia. Si surge alg칰n error durante la conexi칩n, se informa inmediatamente por consola.</p>
<p>Para empezar a enviar los argumentos, disponemos del m칠todo p칰blico <code>init</code>, al cual se le pasan todos los argumentos de la l칤nea de comandos. Este m칠todo se encarga de enviar los argumentos al servidor y de estar atento a sus respuestas, <strong>sin cerrar la conexi칩n</strong>.</p>
<pre><code class="language-typescript"><span class="hl-7">export</span><span class="hl-0"> </span><span class="hl-4">class</span><span class="hl-0"> </span><span class="hl-3">MagicClient</span><span class="hl-0"> {</span><br/><span class="hl-0">  </span><span class="hl-4">private</span><span class="hl-0"> </span><span class="hl-1">socket</span><span class="hl-0">: </span><span class="hl-3">net</span><span class="hl-0">.</span><span class="hl-3">Socket</span><span class="hl-0">;</span><br/><span class="hl-0">  </span><span class="hl-4">private</span><span class="hl-0"> </span><span class="hl-1">data</span><span class="hl-0">: </span><span class="hl-3">string</span><span class="hl-0"> = </span><span class="hl-8">&quot;&quot;</span><span class="hl-0">;</span><br/><br/><span class="hl-0">  </span><span class="hl-4">constructor</span><span class="hl-0">(</span><span class="hl-4">private</span><span class="hl-0"> </span><span class="hl-1">puerto</span><span class="hl-0">: </span><span class="hl-3">number</span><span class="hl-0"> = </span><span class="hl-6">60300</span><span class="hl-0">) {</span><br/><span class="hl-0">    </span><span class="hl-4">this</span><span class="hl-0">.</span><span class="hl-1">puerto</span><span class="hl-0"> = </span><span class="hl-1">puerto</span><span class="hl-0">;</span><br/><span class="hl-0">    </span><span class="hl-4">this</span><span class="hl-0">.</span><span class="hl-1">socket</span><span class="hl-0"> = </span><span class="hl-1">net</span><span class="hl-0">.</span><span class="hl-2">connect</span><span class="hl-0">({ </span><span class="hl-1">port:</span><span class="hl-0"> </span><span class="hl-4">this</span><span class="hl-0">.</span><span class="hl-1">puerto</span><span class="hl-0"> });</span><br/><br/><span class="hl-0">    </span><span class="hl-4">this</span><span class="hl-0">.</span><span class="hl-1">socket</span><span class="hl-0">.</span><span class="hl-2">on</span><span class="hl-0">(</span><span class="hl-8">&quot;error&quot;</span><span class="hl-0">, (</span><span class="hl-1">error</span><span class="hl-0">) </span><span class="hl-4">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">      </span><span class="hl-1">console</span><span class="hl-0">.</span><span class="hl-2">log</span><span class="hl-0">(</span><span class="hl-8">&quot;Ha ocurrido un error al conectar con el servidor: &quot;</span><span class="hl-0"> + </span><span class="hl-1">error</span><span class="hl-0">);</span><br/><span class="hl-0">    });</span><br/><span class="hl-0">  }</span><br/><br/><span class="hl-0">  </span><span class="hl-4">public</span><span class="hl-0"> </span><span class="hl-2">init</span><span class="hl-0">(</span><span class="hl-1">msg</span><span class="hl-0">: </span><span class="hl-3">string</span><span class="hl-0">): </span><span class="hl-3">void</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-4">this</span><span class="hl-0">.</span><span class="hl-2">sendArgv</span><span class="hl-0">(</span><span class="hl-1">msg</span><span class="hl-0">);</span><br/><span class="hl-0">    </span><span class="hl-4">this</span><span class="hl-0">.</span><span class="hl-2">listenServer</span><span class="hl-0">();</span><br/><span class="hl-0">  }</span><br/><br/><span class="hl-0">  </span><span class="hl-4">private</span><span class="hl-0"> </span><span class="hl-2">sendArgv</span><span class="hl-0">(</span><span class="hl-1">argumentos</span><span class="hl-0">: </span><span class="hl-3">string</span><span class="hl-0">): </span><span class="hl-3">void</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">longitudMensaje</span><span class="hl-0"> = </span><span class="hl-1">Buffer</span><span class="hl-0">.</span><span class="hl-2">byteLength</span><span class="hl-0">(</span><span class="hl-1">argumentos</span><span class="hl-0">, </span><span class="hl-8">&quot;utf8&quot;</span><span class="hl-0">);</span><br/><br/><span class="hl-0">    </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">mensajeConLongitud</span><span class="hl-0"> = </span><span class="hl-1">Buffer</span><span class="hl-0">.</span><span class="hl-2">alloc</span><span class="hl-0">(</span><span class="hl-6">4</span><span class="hl-0"> + </span><span class="hl-1">longitudMensaje</span><span class="hl-0">);</span><br/><span class="hl-0">    </span><span class="hl-1">mensajeConLongitud</span><span class="hl-0">.</span><span class="hl-2">writeInt32BE</span><span class="hl-0">(</span><span class="hl-1">longitudMensaje</span><span class="hl-0">, </span><span class="hl-6">0</span><span class="hl-0">);</span><br/><span class="hl-0">    </span><span class="hl-1">mensajeConLongitud</span><span class="hl-0">.</span><span class="hl-2">write</span><span class="hl-0">(</span><span class="hl-1">argumentos</span><span class="hl-0">, </span><span class="hl-6">4</span><span class="hl-0">, </span><span class="hl-8">&quot;utf8&quot;</span><span class="hl-0">);</span><br/><br/><span class="hl-0">    </span><span class="hl-4">this</span><span class="hl-0">.</span><span class="hl-1">socket</span><span class="hl-0">.</span><span class="hl-2">write</span><span class="hl-0">(</span><span class="hl-1">mensajeConLongitud</span><span class="hl-0">);</span><br/><span class="hl-0">  }</span><br/><br/><span class="hl-0">  </span><span class="hl-4">private</span><span class="hl-0"> </span><span class="hl-2">listenServer</span><span class="hl-0">(): </span><span class="hl-3">void</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-4">this</span><span class="hl-0">.</span><span class="hl-1">socket</span><span class="hl-0">.</span><span class="hl-2">on</span><span class="hl-0">(</span><span class="hl-8">&quot;data&quot;</span><span class="hl-0">, (</span><span class="hl-1">data</span><span class="hl-0">) </span><span class="hl-4">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">      </span><span class="hl-4">this</span><span class="hl-0">.</span><span class="hl-1">data</span><span class="hl-0"> += </span><span class="hl-1">data</span><span class="hl-0">;</span><br/><span class="hl-0">    });</span><br/><br/><span class="hl-0">    </span><span class="hl-4">this</span><span class="hl-0">.</span><span class="hl-1">socket</span><span class="hl-0">.</span><span class="hl-2">on</span><span class="hl-0">(</span><span class="hl-8">&quot;data&quot;</span><span class="hl-0">, (</span><span class="hl-1">data</span><span class="hl-0">) </span><span class="hl-4">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">      </span><span class="hl-4">let</span><span class="hl-0"> </span><span class="hl-1">buffer</span><span class="hl-0"> = </span><span class="hl-1">Buffer</span><span class="hl-0">.</span><span class="hl-2">from</span><span class="hl-0">(</span><span class="hl-1">data</span><span class="hl-0">);</span><br/><br/><span class="hl-0">      </span><span class="hl-7">while</span><span class="hl-0"> (</span><span class="hl-1">buffer</span><span class="hl-0">.</span><span class="hl-1">length</span><span class="hl-0"> &gt;= </span><span class="hl-6">4</span><span class="hl-0">) {</span><br/><span class="hl-0">        </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">longitud</span><span class="hl-0"> = </span><span class="hl-1">buffer</span><span class="hl-0">.</span><span class="hl-2">readInt32BE</span><span class="hl-0">(</span><span class="hl-6">0</span><span class="hl-0">);</span><br/><br/><span class="hl-0">        </span><span class="hl-7">if</span><span class="hl-0"> (</span><span class="hl-1">buffer</span><span class="hl-0">.</span><span class="hl-1">length</span><span class="hl-0"> &gt;= </span><span class="hl-1">longitud</span><span class="hl-0"> + </span><span class="hl-6">4</span><span class="hl-0">) {</span><br/><span class="hl-0">          </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">respuestaString</span><span class="hl-0"> = </span><span class="hl-1">buffer</span><br/><span class="hl-0">            .</span><span class="hl-2">subarray</span><span class="hl-0">(</span><span class="hl-6">4</span><span class="hl-0">, </span><span class="hl-1">longitud</span><span class="hl-0"> + </span><span class="hl-6">4</span><span class="hl-0">)</span><br/><span class="hl-0">            .</span><span class="hl-2">toString</span><span class="hl-0">(</span><span class="hl-8">&quot;utf8&quot;</span><span class="hl-0">);</span><br/><span class="hl-0">          </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">respuesta</span><span class="hl-0"> = </span><span class="hl-5">JSON</span><span class="hl-0">.</span><span class="hl-2">parse</span><span class="hl-0">(</span><span class="hl-1">respuestaString</span><span class="hl-0">);</span><br/><br/><span class="hl-0">          </span><span class="hl-1">console</span><span class="hl-0">.</span><span class="hl-2">log</span><span class="hl-0">(</span><span class="hl-1">respuesta</span><span class="hl-0">.</span><span class="hl-1">data</span><span class="hl-0">);</span><br/><br/><span class="hl-0">          </span><span class="hl-1">buffer</span><span class="hl-0"> = </span><span class="hl-1">buffer</span><span class="hl-0">.</span><span class="hl-2">subarray</span><span class="hl-0">(</span><span class="hl-1">longitud</span><span class="hl-0"> + </span><span class="hl-6">4</span><span class="hl-0">);</span><br/><span class="hl-0">        } </span><span class="hl-7">else</span><span class="hl-0"> {</span><br/><span class="hl-0">          </span><span class="hl-7">break</span><span class="hl-0">;</span><br/><span class="hl-0">        }</span><br/><span class="hl-0">      }</span><br/><span class="hl-0">    });</span><br/><span class="hl-0">  }</span><br/><span class="hl-0">}</span>
</code><button>Copy</button></pre>
<p>Como podemos observar, la forma en que recibimos los datos es a trav칠s de un buffer. En este proceso, primero obtenemos el tama침o del mensaje que el servidor va a enviar. Luego, esperamos a recibir el mensaje completo, es decir, los bytes que el servidor especifica, antes de procesar el buffer. Este enfoque tambi칠n se implementa en el servidor. Creo que esta es una manera simple y efectiva de garantizar que los mensajes se transmitan correctamente de un lado a otro.</p>
<p>Una vez tenemos la parte del cliente resuelta pasamos al servidor. Vamos a tener dos tipos de mensajes, en primer lugar vamos a tener un mensaje del tipo <code>RequestMessage</code> que ser치 el tipo de mensaje que enviar치 el cliente al servidor solicitando un servicio.</p>
<pre><code class="language-typescript"><span class="hl-7">export</span><span class="hl-0"> </span><span class="hl-4">interface</span><span class="hl-0"> </span><span class="hl-3">RequestMessage</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-1">type</span><span class="hl-0">: </span><span class="hl-3">MessageType</span><span class="hl-0">;</span><br/><span class="hl-0">    </span><span class="hl-1">data</span><span class="hl-0">: </span><span class="hl-3">string</span><span class="hl-0">[];</span><br/><span class="hl-0">}</span>
</code><button>Copy</button></pre>
<p>Vemos que este mensaje viene acompa침ado de un <code>type</code> de tipo <code>MessageType</code>, este 칰ltimo ser치 el servicio que se est치 solicitando, recordemos que eran read, add, list, remove y update. En este caso ser치 un enumerado.</p>
<pre><code class="language-typescript"><span class="hl-7">export</span><span class="hl-0"> </span><span class="hl-4">enum</span><span class="hl-0"> </span><span class="hl-3">MessageType</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-5">READ</span><span class="hl-0"> = </span><span class="hl-8">&quot;read&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">    </span><span class="hl-5">ADD</span><span class="hl-0"> = </span><span class="hl-8">&quot;add&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">    </span><span class="hl-5">REMOVE</span><span class="hl-0"> = </span><span class="hl-8">&quot;remove&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">    </span><span class="hl-5">UPDATE</span><span class="hl-0"> = </span><span class="hl-8">&quot;update&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">    </span><span class="hl-5">LIST</span><span class="hl-0"> = </span><span class="hl-8">&quot;list&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">  }</span>
</code><button>Copy</button></pre>
<p>Con esto, hemos definido los comandos que podemos procesar; cualquier comando que no est칠 incluido aqu칤 ser치 ignorado. Una vez que recibimos el mensaje <code>RequestMessage</code>, lo gestionamos utilizando la funci칩n as칤ncrona <code>messageHandler</code>. Esta funci칩n se encarga de manejar la solicitud y ejecutar la API sincr칩nica que mencion칠 anteriormente.</p>
<p>Lo que hace es gestionar la petici칩n dependiendo del servicio que se solicita, y en cada apartado se lleva a cabo la l칩gica necesaria:</p>
<pre><code class="language-typescript"><span class="hl-7">export</span><span class="hl-0"> </span><span class="hl-4">function</span><span class="hl-0"> </span><span class="hl-2">messageHandler</span><span class="hl-0">(</span><br/><span class="hl-0">    </span><span class="hl-1">msg</span><span class="hl-0">: </span><span class="hl-3">string</span><span class="hl-0">,</span><br/><span class="hl-0">    </span><span class="hl-2">callback</span><span class="hl-0">: (</span><span class="hl-1">error</span><span class="hl-0">: </span><span class="hl-3">Error</span><span class="hl-0"> | </span><span class="hl-3">null</span><span class="hl-0">, </span><span class="hl-1">response</span><span class="hl-0">?: </span><span class="hl-3">string</span><span class="hl-0">) </span><span class="hl-4">=&gt;</span><span class="hl-0"> </span><span class="hl-3">void</span><span class="hl-0">,</span><br/><span class="hl-0">  ) {</span><br/><span class="hl-0">    </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">message</span><span class="hl-0"> = </span><span class="hl-5">JSON</span><span class="hl-0">.</span><span class="hl-2">parse</span><span class="hl-0">(</span><span class="hl-1">msg</span><span class="hl-0">) </span><span class="hl-7">as</span><span class="hl-0"> </span><span class="hl-3">RequestMessage</span><span class="hl-0">;</span><br/><br/><span class="hl-0">  </span><br/><span class="hl-0">    </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">handler</span><span class="hl-0"> = </span><span class="hl-4">new</span><span class="hl-0"> </span><span class="hl-2">CardCollectionsHandlerAsync</span><span class="hl-0">(</span><span class="hl-1">message</span><span class="hl-0">.</span><span class="hl-1">data</span><span class="hl-0">[</span><span class="hl-6">0</span><span class="hl-0">]);</span><br/><span class="hl-0">  </span><br/><span class="hl-0">    </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">carta</span><span class="hl-0">: </span><span class="hl-3">ICard</span><span class="hl-0"> = {</span><br/><span class="hl-0">      </span><span class="hl-1">id:</span><span class="hl-0"> </span><span class="hl-2">parseInt</span><span class="hl-0">(</span><span class="hl-1">message</span><span class="hl-0">.</span><span class="hl-1">data</span><span class="hl-0">[</span><span class="hl-6">1</span><span class="hl-0">]),</span><br/><span class="hl-0">      </span><span class="hl-1">name:</span><span class="hl-0"> </span><span class="hl-1">message</span><span class="hl-0">.</span><span class="hl-1">data</span><span class="hl-0">[</span><span class="hl-6">2</span><span class="hl-0">],</span><br/><span class="hl-0">      </span><span class="hl-1">manaCost:</span><span class="hl-0"> </span><span class="hl-2">parseInt</span><span class="hl-0">(</span><span class="hl-1">message</span><span class="hl-0">.</span><span class="hl-1">data</span><span class="hl-0">[</span><span class="hl-6">3</span><span class="hl-0">]),</span><br/><span class="hl-0">      </span><span class="hl-1">color:</span><span class="hl-0"> </span><span class="hl-1">message</span><span class="hl-0">.</span><span class="hl-1">data</span><span class="hl-0">[</span><span class="hl-6">4</span><span class="hl-0">] </span><span class="hl-7">as</span><span class="hl-0"> </span><span class="hl-3">Color</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">lineType:</span><span class="hl-0"> </span><span class="hl-1">message</span><span class="hl-0">.</span><span class="hl-1">data</span><span class="hl-0">[</span><span class="hl-6">5</span><span class="hl-0">] </span><span class="hl-7">as</span><span class="hl-0"> </span><span class="hl-3">TypeLine</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">rarity:</span><span class="hl-0"> </span><span class="hl-1">message</span><span class="hl-0">.</span><span class="hl-1">data</span><span class="hl-0">[</span><span class="hl-6">6</span><span class="hl-0">] </span><span class="hl-7">as</span><span class="hl-0"> </span><span class="hl-3">Rarity</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">ruleText:</span><span class="hl-0"> </span><span class="hl-1">message</span><span class="hl-0">.</span><span class="hl-1">data</span><span class="hl-0">[</span><span class="hl-6">7</span><span class="hl-0">],</span><br/><span class="hl-0">      </span><span class="hl-1">strength:</span><span class="hl-0"> </span><span class="hl-2">parseInt</span><span class="hl-0">(</span><span class="hl-1">message</span><span class="hl-0">.</span><span class="hl-1">data</span><span class="hl-0">[</span><span class="hl-6">8</span><span class="hl-0">]),</span><br/><span class="hl-0">      </span><span class="hl-1">endurance:</span><span class="hl-0"> </span><span class="hl-2">parseInt</span><span class="hl-0">(</span><span class="hl-1">message</span><span class="hl-0">.</span><span class="hl-1">data</span><span class="hl-0">[</span><span class="hl-6">9</span><span class="hl-0">]),</span><br/><span class="hl-0">      </span><span class="hl-1">brandsLoyalty:</span><span class="hl-0"> </span><span class="hl-2">parseInt</span><span class="hl-0">(</span><span class="hl-1">message</span><span class="hl-0">.</span><span class="hl-1">data</span><span class="hl-0">[</span><span class="hl-6">10</span><span class="hl-0">]),</span><br/><span class="hl-0">      </span><span class="hl-1">marketValue:</span><span class="hl-0"> </span><span class="hl-2">parseInt</span><span class="hl-0">(</span><span class="hl-1">message</span><span class="hl-0">.</span><span class="hl-1">data</span><span class="hl-0">[</span><span class="hl-6">11</span><span class="hl-0">]),</span><br/><span class="hl-0">    };</span><br/><br/><span class="hl-0">    </span><span class="hl-7">switch</span><span class="hl-0"> (</span><span class="hl-1">message</span><span class="hl-0">.</span><span class="hl-1">type</span><span class="hl-0">) {</span><br/><span class="hl-0">      </span><span class="hl-7">case</span><span class="hl-0"> </span><span class="hl-1">MessageType</span><span class="hl-0">.</span><span class="hl-5">ADD</span><span class="hl-0">:</span><br/><span class="hl-0">        </span><span class="hl-1">console</span><span class="hl-0">.</span><span class="hl-2">log</span><span class="hl-0">(</span><span class="hl-1">chalk</span><span class="hl-0">.</span><span class="hl-2">yellow</span><span class="hl-0">(</span><span class="hl-8">&quot;Se ha solicitado a침adir una carta por parte del usuario: &quot;</span><span class="hl-0"> + </span><span class="hl-1">message</span><span class="hl-0">.</span><span class="hl-1">data</span><span class="hl-0">[</span><span class="hl-6">0</span><span class="hl-0">]))</span><br/><span class="hl-0">        </span><span class="hl-1">handler</span><span class="hl-0">.</span><span class="hl-2">addCard</span><span class="hl-0">(</span><span class="hl-1">carta</span><span class="hl-0">, (</span><span class="hl-1">error</span><span class="hl-0">) </span><span class="hl-4">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">          </span><span class="hl-7">if</span><span class="hl-0"> (</span><span class="hl-1">error</span><span class="hl-0">) {</span><br/><span class="hl-0">            </span><span class="hl-1">console</span><span class="hl-0">.</span><span class="hl-2">log</span><span class="hl-0">(</span><span class="hl-1">chalk</span><span class="hl-0">.</span><span class="hl-1">red</span><span class="hl-0">.</span><span class="hl-2">bold</span><span class="hl-0">(</span><span class="hl-8">&quot;Operacion fallida por error: &quot;</span><span class="hl-0"> + </span><span class="hl-1">error</span><span class="hl-0">.</span><span class="hl-1">message</span><span class="hl-0">));</span><br/><span class="hl-0">            </span><span class="hl-2">callback</span><span class="hl-0">(</span><span class="hl-1">error</span><span class="hl-0">);</span><br/><span class="hl-0">            </span><span class="hl-7">return</span><span class="hl-0">;</span><br/><span class="hl-0">          } </span><span class="hl-7">else</span><span class="hl-0"> {</span><br/><span class="hl-0">            </span><span class="hl-1">console</span><span class="hl-0">.</span><span class="hl-2">log</span><span class="hl-0">(</span><span class="hl-1">chalk</span><span class="hl-0">.</span><span class="hl-1">green</span><span class="hl-0">.</span><span class="hl-2">bold</span><span class="hl-0">(</span><span class="hl-8">&quot;Operacion realizada con exito&quot;</span><span class="hl-0">));</span><br/><span class="hl-0">            </span><span class="hl-2">callback</span><span class="hl-0">(</span><span class="hl-4">null</span><span class="hl-0">, </span><span class="hl-1">chalk</span><span class="hl-0">.</span><span class="hl-1">green</span><span class="hl-0">.</span><span class="hl-2">bold</span><span class="hl-0">(</span><span class="hl-8">&quot;Card added successfully&quot;</span><span class="hl-0">));</span><br/><span class="hl-0">          }</span><br/><span class="hl-0">        });</span><br/><span class="hl-0">        </span><span class="hl-7">break</span><span class="hl-0">;</span><br/><span class="hl-0">      </span><span class="hl-7">case</span><span class="hl-0"> </span><span class="hl-1">MessageType</span><span class="hl-0">.</span><span class="hl-5">REMOVE</span><span class="hl-0">:</span><br/><span class="hl-0">        </span><span class="hl-1">console</span><span class="hl-0">.</span><span class="hl-2">log</span><span class="hl-0">(</span><span class="hl-1">chalk</span><span class="hl-0">.</span><span class="hl-2">yellow</span><span class="hl-0">(</span><span class="hl-8">&quot;Se ha solicitado eliminar una carta por parte del usuario: &quot;</span><span class="hl-0"> + </span><span class="hl-1">message</span><span class="hl-0">.</span><span class="hl-1">data</span><span class="hl-0">[</span><span class="hl-6">0</span><span class="hl-0">]))</span><br/><span class="hl-0">        </span><span class="hl-1">handler</span><span class="hl-0">.</span><span class="hl-2">removeCard</span><span class="hl-0">(</span><span class="hl-2">parseInt</span><span class="hl-0">(</span><span class="hl-1">message</span><span class="hl-0">.</span><span class="hl-1">data</span><span class="hl-0">[</span><span class="hl-6">1</span><span class="hl-0">]), (</span><span class="hl-1">error</span><span class="hl-0">) </span><span class="hl-4">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">          </span><span class="hl-7">if</span><span class="hl-0"> (</span><span class="hl-1">error</span><span class="hl-0">) {</span><br/><span class="hl-0">            </span><span class="hl-1">console</span><span class="hl-0">.</span><span class="hl-2">log</span><span class="hl-0">(</span><span class="hl-1">chalk</span><span class="hl-0">.</span><span class="hl-1">red</span><span class="hl-0">.</span><span class="hl-2">bold</span><span class="hl-0">(</span><span class="hl-8">&quot;Operacion fallida por error: &quot;</span><span class="hl-0"> + </span><span class="hl-1">error</span><span class="hl-0">.</span><span class="hl-1">message</span><span class="hl-0">));</span><br/><span class="hl-0">            </span><span class="hl-2">callback</span><span class="hl-0">(</span><span class="hl-1">error</span><span class="hl-0">);</span><br/><span class="hl-0">            </span><span class="hl-7">return</span><span class="hl-0">;</span><br/><span class="hl-0">          } </span><span class="hl-7">else</span><span class="hl-0"> {</span><br/><span class="hl-0">            </span><span class="hl-1">console</span><span class="hl-0">.</span><span class="hl-2">log</span><span class="hl-0">(</span><span class="hl-1">chalk</span><span class="hl-0">.</span><span class="hl-1">green</span><span class="hl-0">.</span><span class="hl-2">bold</span><span class="hl-0">(</span><span class="hl-8">&quot;Operacion realizada con exito&quot;</span><span class="hl-0">));</span><br/><span class="hl-0">            </span><span class="hl-2">callback</span><span class="hl-0">(</span><span class="hl-4">null</span><span class="hl-0">, </span><span class="hl-1">chalk</span><span class="hl-0">.</span><span class="hl-1">green</span><span class="hl-0">.</span><span class="hl-2">bold</span><span class="hl-0">(</span><span class="hl-8">&quot;Card removed successfully&quot;</span><span class="hl-0">));</span><br/><span class="hl-0">          }</span><br/><span class="hl-0">        });</span><br/><span class="hl-0">        </span><span class="hl-7">break</span><span class="hl-0">;</span><br/><span class="hl-0">      </span><span class="hl-7">case</span><span class="hl-0"> </span><span class="hl-1">MessageType</span><span class="hl-0">.</span><span class="hl-5">READ</span><span class="hl-0">:</span><br/><span class="hl-0">        </span><span class="hl-1">console</span><span class="hl-0">.</span><span class="hl-2">log</span><span class="hl-0">(</span><span class="hl-1">chalk</span><span class="hl-0">.</span><span class="hl-2">yellow</span><span class="hl-0">(</span><span class="hl-8">&quot;Se ha solicitado leer una carta por parte del usuario: &quot;</span><span class="hl-0"> + </span><span class="hl-1">message</span><span class="hl-0">.</span><span class="hl-1">data</span><span class="hl-0">[</span><span class="hl-6">0</span><span class="hl-0">]))</span><br/><span class="hl-0">        </span><span class="hl-1">handler</span><span class="hl-0">.</span><span class="hl-2">getStringCard</span><span class="hl-0">(</span><span class="hl-2">parseInt</span><span class="hl-0">(</span><span class="hl-1">message</span><span class="hl-0">.</span><span class="hl-1">data</span><span class="hl-0">[</span><span class="hl-6">1</span><span class="hl-0">]), (</span><span class="hl-1">error</span><span class="hl-0">, </span><span class="hl-1">string</span><span class="hl-0">) </span><span class="hl-4">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">          </span><span class="hl-7">if</span><span class="hl-0"> (</span><span class="hl-1">error</span><span class="hl-0">) {</span><br/><span class="hl-0">            </span><span class="hl-1">console</span><span class="hl-0">.</span><span class="hl-2">log</span><span class="hl-0">(</span><span class="hl-1">chalk</span><span class="hl-0">.</span><span class="hl-1">red</span><span class="hl-0">.</span><span class="hl-2">bold</span><span class="hl-0">(</span><span class="hl-8">&quot;Operacion fallida por error: &quot;</span><span class="hl-0"> + </span><span class="hl-1">error</span><span class="hl-0">.</span><span class="hl-1">message</span><span class="hl-0">));</span><br/><span class="hl-0">            </span><span class="hl-2">callback</span><span class="hl-0">(</span><span class="hl-1">error</span><span class="hl-0">);</span><br/><span class="hl-0">            </span><span class="hl-7">return</span><span class="hl-0">;</span><br/><span class="hl-0">          } </span><span class="hl-7">else</span><span class="hl-0"> {</span><br/><span class="hl-0">            </span><span class="hl-1">console</span><span class="hl-0">.</span><span class="hl-2">log</span><span class="hl-0">(</span><span class="hl-1">chalk</span><span class="hl-0">.</span><span class="hl-1">green</span><span class="hl-0">.</span><span class="hl-2">bold</span><span class="hl-0">(</span><span class="hl-8">&quot;Operacion realizada con exito&quot;</span><span class="hl-0">));</span><br/><span class="hl-0">            </span><span class="hl-2">callback</span><span class="hl-0">(</span><span class="hl-4">null</span><span class="hl-0">, </span><span class="hl-1">string</span><span class="hl-0">);</span><br/><span class="hl-0">          }</span><br/><span class="hl-0">        });</span><br/><span class="hl-0">        </span><span class="hl-7">break</span><span class="hl-0">;</span><br/><span class="hl-0">        ....</span><br/><span class="hl-0">        </span><span class="hl-7">default</span><span class="hl-0">:</span><br/><span class="hl-0">            </span><span class="hl-2">callback</span><span class="hl-0">(</span><span class="hl-4">new</span><span class="hl-0"> </span><span class="hl-2">Error</span><span class="hl-0">(</span><span class="hl-1">chalk</span><span class="hl-0">.</span><span class="hl-1">red</span><span class="hl-0">.</span><span class="hl-2">bold</span><span class="hl-0">(</span><span class="hl-8">&quot;Unknown message type&quot;</span><span class="hl-0">)));</span><br/><span class="hl-0">    }</span>
</code><button>Copy</button></pre>
<p>Y esta funci칩n genera una respuesta de tipo <code>ResponseMessage</code> que ser치 la que se env칤a al cliente para que la interprete y se cierre la conexi칩n.</p>
<pre><code class="language-typescript"><span class="hl-7">export</span><span class="hl-0"> </span><span class="hl-4">interface</span><span class="hl-0"> </span><span class="hl-3">ResponseMessage</span><span class="hl-0"> {</span><br/><span class="hl-0">  </span><span class="hl-1">success</span><span class="hl-0">: </span><span class="hl-3">boolean</span><span class="hl-0">;</span><br/><span class="hl-0">  </span><span class="hl-1">data</span><span class="hl-0">: </span><span class="hl-3">string</span><span class="hl-0">;</span><br/><span class="hl-0">}</span>
</code><button>Copy</button></pre>
<p>La propiedad <code>data</code> siempre se mostrar치 en la consola del cliente, marcando as칤 el final del proceso de solicitud-respuesta.</p>
<p>Anteriormente, mencionamos que el cliente utilizar치 la colecci칩n como lo hac칤a antes, lo cual se lograba a trav칠s de yargs. Por lo tanto, he adaptado el archivo <code>magic-app.js</code> que ten칤amos en la pr치ctica anterior. Los cambios principales se centran en establecer los comandos en modo <code>strict</code>, lo que significa que se deben proporcionar exclusivamente los argumentos necesarios. Esta medida es muy 칰til para gestionar posibles errores y entradas maliciosas por parte del usuario.</p>
<p>Dicho esto, para cada comando vamos a crear una instancia de <code>MagicClient</code> y enviaremos una petici칩n dependiendo del comando que estemos ejecutando. Un ejemplo ser칤a el comando de lectura:</p>
<pre><code class="language-typescript"><span class="hl-2">yargs</span><span class="hl-0">(</span><span class="hl-2">hideBin</span><span class="hl-0">(</span><span class="hl-1">process</span><span class="hl-0">.</span><span class="hl-1">argv</span><span class="hl-0">))</span><br/><span class="hl-0">  .</span><span class="hl-2">strict</span><span class="hl-0">()</span><br/><span class="hl-0">  .</span><span class="hl-2">command</span><span class="hl-0">(</span><br/><span class="hl-0">    </span><span class="hl-8">&quot;read&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">    </span><span class="hl-8">&quot;Read a card of the user collection&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">    {</span><br/><span class="hl-0">      </span><span class="hl-1">user:</span><span class="hl-0"> {</span><br/><span class="hl-0">        </span><span class="hl-1">alias:</span><span class="hl-0"> </span><span class="hl-8">&quot;u&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-1">description:</span><span class="hl-0"> </span><span class="hl-8">&quot;User Name&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-1">type:</span><span class="hl-0"> </span><span class="hl-8">&quot;string&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-1">demandOption:</span><span class="hl-0"> </span><span class="hl-4">true</span><span class="hl-0">,</span><br/><span class="hl-0">      },</span><br/><span class="hl-0">      </span><span class="hl-1">id:</span><span class="hl-0"> {</span><br/><span class="hl-0">        </span><span class="hl-1">alias:</span><span class="hl-0"> </span><span class="hl-8">&quot;i&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-1">description:</span><span class="hl-0"> </span><span class="hl-8">&quot;Card ID&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-1">type:</span><span class="hl-0"> </span><span class="hl-8">&quot;number&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-1">demandOption:</span><span class="hl-0"> </span><span class="hl-4">true</span><span class="hl-0">,</span><br/><span class="hl-0">      },</span><br/><span class="hl-0">    },</span><br/><span class="hl-0">    (</span><span class="hl-1">argv</span><span class="hl-0">) </span><span class="hl-4">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">      </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">client</span><span class="hl-0"> = </span><span class="hl-4">new</span><span class="hl-0"> </span><span class="hl-2">MagicClient</span><span class="hl-0">();</span><br/><span class="hl-0">      </span><span class="hl-1">client</span><span class="hl-0">.</span><span class="hl-2">init</span><span class="hl-0">(</span><br/><span class="hl-0">        </span><span class="hl-5">JSON</span><span class="hl-0">.</span><span class="hl-2">stringify</span><span class="hl-0">({</span><br/><span class="hl-0">          </span><span class="hl-1">type:</span><span class="hl-0"> </span><span class="hl-1">MessageType</span><span class="hl-0">.</span><span class="hl-5">READ</span><span class="hl-0">,</span><br/><span class="hl-0">          </span><span class="hl-1">data:</span><span class="hl-0"> [</span><span class="hl-1">argv</span><span class="hl-0">.</span><span class="hl-1">user</span><span class="hl-0">, </span><span class="hl-1">argv</span><span class="hl-0">.</span><span class="hl-1">id</span><span class="hl-0">.</span><span class="hl-2">toString</span><span class="hl-0">()],</span><br/><span class="hl-0">        }),</span><br/><span class="hl-0">      );</span><br/><span class="hl-0">    },</span><br/><span class="hl-0">  )</span>
</code><button>Copy</button></pre>
<p>Esta estructura nos permite evitar muchas comprobaciones que el servidor tendr칤a que realizar. Adem치s, nos permite filtrar algunos par치metros inadecuados al actualizar la carta, como el color o el tipo.</p>
<a id="md:modificacion-pe101" class="tsd-anchor"></a><h1><a href="#md:modificacion-pe101">Modificacion PE101</a></h1><p>El objetivo de la modificaci칩n era aplicar el patr칩n de callback a dos m칠todos de la pr치ctica anterior para convertirlos en as칤ncronos. La dificultad radicaba en la posibilidad de que fuera necesario modificar m치s de dos m칠todos, ya que, en mi caso, el m칠todo de eliminaci칩n depend칤a del m칠todo para verificar la existencia de una carta en una colecci칩n.</p>
<p>Partiendo de la clase <code>CardCollectionHandler</code> que ten칤amos anteriormente, elimin칠 los m칠todos que no iba a utilizar y realic칠 diversos cambios.</p>
<p>En addCard por ejemplo:</p>
<pre><code class="language-typescript"><span class="hl-0">  </span><span class="hl-1">public</span><span class="hl-0"> </span><span class="hl-2">addCard</span><span class="hl-0">(</span><span class="hl-1">card</span><span class="hl-0">: </span><span class="hl-1">ICard</span><span class="hl-0">, </span><span class="hl-1">callback</span><span class="hl-0">: (</span><span class="hl-1">error</span><span class="hl-0">: </span><span class="hl-3">Error</span><span class="hl-0"> | </span><span class="hl-3">null</span><span class="hl-0">) </span><span class="hl-4">=&gt;</span><span class="hl-0"> </span><span class="hl-4">void</span><span class="hl-0">): </span><span class="hl-4">void</span><span class="hl-0"> {</span><br/><br/><span class="hl-0">    </span><span class="hl-4">this</span><span class="hl-0">.</span><span class="hl-2">cardExists</span><span class="hl-0">(</span><span class="hl-1">card</span><span class="hl-0">.</span><span class="hl-1">id</span><span class="hl-0">, (</span><span class="hl-1">exists</span><span class="hl-0">) </span><span class="hl-4">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">      </span><span class="hl-7">if</span><span class="hl-0"> (</span><span class="hl-1">exists</span><span class="hl-0">) {</span><br/><span class="hl-0">        </span><span class="hl-7">return</span><span class="hl-0"> </span><span class="hl-2">callback</span><span class="hl-0">(</span><br/><span class="hl-0">          </span><span class="hl-4">new</span><span class="hl-0"> </span><span class="hl-2">Error</span><span class="hl-0">(</span><span class="hl-8">&quot;Card already exists at &quot;</span><span class="hl-0"> + </span><span class="hl-4">this</span><span class="hl-0">.</span><span class="hl-1">userName</span><span class="hl-0"> + </span><span class="hl-8">&quot; collection&quot;</span><span class="hl-0">),</span><br/><span class="hl-0">        );</span><br/><span class="hl-0">      }</span><br/><br/><span class="hl-0">      </span><span class="hl-7">if</span><span class="hl-0"> (</span><span class="hl-1">card</span><span class="hl-0">.</span><span class="hl-1">lineType</span><span class="hl-0"> === </span><span class="hl-8">&quot;Creature&quot;</span><span class="hl-0"> &amp;&amp; (!</span><span class="hl-1">card</span><span class="hl-0">.</span><span class="hl-1">strength</span><span class="hl-0"> || !</span><span class="hl-1">card</span><span class="hl-0">.</span><span class="hl-1">endurance</span><span class="hl-0">)) {</span><br/><span class="hl-0">        </span><span class="hl-7">return</span><span class="hl-0"> </span><span class="hl-2">callback</span><span class="hl-0">(</span><br/><span class="hl-0">          </span><span class="hl-4">new</span><span class="hl-0"> </span><span class="hl-2">Error</span><span class="hl-0">(</span><span class="hl-8">&quot;Creature card must have strength and endurance&quot;</span><span class="hl-0">),</span><br/><span class="hl-0">        );</span><br/><span class="hl-0">      }</span><br/><br/><span class="hl-0">      </span><span class="hl-7">if</span><span class="hl-0"> (</span><span class="hl-1">card</span><span class="hl-0">.</span><span class="hl-1">lineType</span><span class="hl-0"> === </span><span class="hl-8">&quot;Planeswalker&quot;</span><span class="hl-0"> &amp;&amp; !</span><span class="hl-1">card</span><span class="hl-0">.</span><span class="hl-1">brandsLoyalty</span><span class="hl-0">) {</span><br/><span class="hl-0">        </span><span class="hl-7">return</span><span class="hl-0"> </span><span class="hl-2">callback</span><span class="hl-0">(</span><br/><span class="hl-0">          </span><span class="hl-4">new</span><span class="hl-0"> </span><span class="hl-2">Error</span><span class="hl-0">(</span><span class="hl-8">&quot;Planeswalker card must have brands loyalty&quot;</span><span class="hl-0">),</span><br/><span class="hl-0">        );</span><br/><span class="hl-0">      }</span><br/><br/><span class="hl-0">      </span><span class="hl-4">this</span><span class="hl-0">.</span><span class="hl-2">writeCardToFileAsync</span><span class="hl-0">(</span><span class="hl-1">card</span><span class="hl-0">, (</span><span class="hl-1">error</span><span class="hl-0">) </span><span class="hl-4">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">        </span><span class="hl-7">if</span><span class="hl-0"> (</span><span class="hl-1">error</span><span class="hl-0">) {</span><br/><span class="hl-0">          </span><span class="hl-7">return</span><span class="hl-0"> </span><span class="hl-2">callback</span><span class="hl-0">(</span><span class="hl-1">error</span><span class="hl-0">);</span><br/><span class="hl-0">        }</span><br/><span class="hl-0">        </span><span class="hl-2">callback</span><span class="hl-0">(</span><span class="hl-4">null</span><span class="hl-0">);</span><br/><span class="hl-0">      });</span><br/><span class="hl-0">    });</span><br/><span class="hl-0">  }</span><br/><br/><span class="hl-0">  </span><span class="hl-1">private</span><span class="hl-0"> </span><span class="hl-2">writeCardToFileAsync</span><span class="hl-0">(</span><br/><span class="hl-0">    </span><span class="hl-1">card</span><span class="hl-0">: </span><span class="hl-1">ICard</span><span class="hl-0">,</span><br/><span class="hl-0">    </span><span class="hl-1">callback</span><span class="hl-0">: (</span><span class="hl-1">error</span><span class="hl-0">: </span><span class="hl-3">Error</span><span class="hl-0"> | </span><span class="hl-3">null</span><span class="hl-0">) </span><span class="hl-4">=&gt;</span><span class="hl-0"> </span><span class="hl-4">void</span><span class="hl-0">,</span><br/><span class="hl-0">  ): </span><span class="hl-4">void</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">filePath</span><span class="hl-0"> = </span><span class="hl-4">this</span><span class="hl-0">.</span><span class="hl-2">getCardFilePath</span><span class="hl-0">(</span><span class="hl-1">card</span><span class="hl-0">.</span><span class="hl-1">id</span><span class="hl-0">);</span><br/><span class="hl-0">    </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">directoryPath</span><span class="hl-0"> = </span><span class="hl-1">path</span><span class="hl-0">.</span><span class="hl-2">dirname</span><span class="hl-0">(</span><span class="hl-1">filePath</span><span class="hl-0">);</span><br/><br/><span class="hl-0">    </span><span class="hl-1">fs</span><span class="hl-0">.</span><span class="hl-2">mkdir</span><span class="hl-0">(</span><span class="hl-1">directoryPath</span><span class="hl-0">, { </span><span class="hl-1">recursive:</span><span class="hl-0"> </span><span class="hl-4">true</span><span class="hl-0"> }, (</span><span class="hl-1">error</span><span class="hl-0">) </span><span class="hl-4">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">      </span><span class="hl-7">if</span><span class="hl-0"> (</span><span class="hl-1">error</span><span class="hl-0">) {</span><br/><span class="hl-0">        </span><span class="hl-7">return</span><span class="hl-0"> </span><span class="hl-2">callback</span><span class="hl-0">(</span><span class="hl-1">error</span><span class="hl-0">);</span><br/><span class="hl-0">      }</span><br/><br/><span class="hl-0">      </span><span class="hl-1">fs</span><span class="hl-0">.</span><span class="hl-2">writeFile</span><span class="hl-0">(</span><span class="hl-1">filePath</span><span class="hl-0">, </span><span class="hl-5">JSON</span><span class="hl-0">.</span><span class="hl-2">stringify</span><span class="hl-0">(</span><span class="hl-1">card</span><span class="hl-0">, </span><span class="hl-4">null</span><span class="hl-0">, </span><span class="hl-6">1</span><span class="hl-0">), (</span><span class="hl-1">error</span><span class="hl-0">) </span><span class="hl-4">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">        </span><span class="hl-7">if</span><span class="hl-0"> (</span><span class="hl-1">error</span><span class="hl-0">) {</span><br/><span class="hl-0">          </span><span class="hl-7">return</span><span class="hl-0"> </span><span class="hl-2">callback</span><span class="hl-0">(</span><span class="hl-1">error</span><span class="hl-0">);</span><br/><span class="hl-0">        }</span><br/><span class="hl-0">        </span><span class="hl-2">callback</span><span class="hl-0">(</span><span class="hl-4">null</span><span class="hl-0">);</span><br/><span class="hl-0">      });</span><br/><span class="hl-0">    });</span><br/><span class="hl-0">  }</span><br/>
</code><button>Copy</button></pre>
<a id="md:conclusi칩n" class="tsd-anchor"></a><h1><a href="#md:conclusi칩n">Conclusi칩n</a></h1><p>Esta pr치ctica ha sido interesante para entender y desarrollar un proyecto con sockets de una manera m치s concreta. Aunque trabajamos con sockets el a침o pasado, el proyecto fue poco flexible. En este caso, la flexibilidad ha sido 칰til para evaluar qu칠 decisiones son m치s interesantes de abordar.</p>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-index-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><h4 class="uppercase">Member Visibility</h4><form><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-private" name="private"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Private</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></form></div><div class="tsd-theme-toggle"><h4 class="uppercase">Theme</h4><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-index-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><ul><li><ul><li><a href="#md:introducci칩n"><span>Introducci칩n</span></a></li><li><a href="#md:aplicaci칩n-para-coleccionistas-de-cartas-magic-cliente-servidor"><span>Aplicaci칩n para coleccionistas de cartas <wbr/>Magic cliente-<wbr/>servidor</span></a></li><li><a href="#md:modificacion-pe101"><span>Modificacion PE101</span></a></li><li><a href="#md:conclusi칩n"><span>Conclusi칩n</span></a></li></ul></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="index.html" class="current"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="assets/icons.svg#icon-1"></use></svg><span>游눹 Pr치ctica 10 - Aplicaci칩n cliente-servidor para coleccionistas de cartas Magic 游눹</span></a><ul class="tsd-small-nested-navigation" id="tsd-nav-container" data-base="."><li>Loading...</li></ul></nav></div></div></div><div class="tsd-generator"><p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></div><div class="overlay"></div><script>
          try {
            const generateLinkElement = document.querySelector(".tsd-generator a");
            const link = document.createElement("a");
            Object.assign(link, {
              href: "https://github.com/dmnsgn/typedoc-material-theme",
              target: "_blank",
              rel: "noreferrer",
              innerText: "typedoc-material-theme."
            });
            generateLinkElement.insertAdjacentElement("afterend", link);
            generateLinkElement.insertAdjacentText("afterend", " with ");
          } catch (error) {

          }
        </script></body></html>